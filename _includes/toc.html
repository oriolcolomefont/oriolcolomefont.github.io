<!-- Table of Contents Component -->
{% assign toc_enabled = page.toc | default: true %}
{% if toc_enabled and content contains '<h2' %}
<nav class="toc-container bg-gray-50 rounded-xl p-6 mb-8 sticky top-24" id="toc">
  <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
    </svg>
    Table of Contents
  </h3>
  <ul class="toc-list space-y-2" id="toc-list">
    <!-- Generated dynamically by JavaScript -->
  </ul>
</nav>

<script>
(function() {
  // Generate table of contents from headings
  const article = document.querySelector('.prose');
  if (!article) return;
  
  const headings = article.querySelectorAll('h2, h3');
  if (headings.length === 0) {
    document.getElementById('toc')?.remove();
    return;
  }
  
  const tocList = document.getElementById('toc-list');
  if (!tocList) return;
  
  headings.forEach((heading, index) => {
    // Add ID to heading if it doesn't have one
    if (!heading.id) {
      heading.id = `heading-${index}`;
    }
    
    const li = document.createElement('li');
    const a = document.createElement('a');
    
    a.href = `#${heading.id}`;
    a.textContent = heading.textContent;
    a.className = 'text-gray-700 hover:text-primary-600 transition-colors text-sm block';
    
    // Indent h3 elements
    if (heading.tagName === 'H3') {
      li.className = 'ml-4';
    }
    
    li.appendChild(a);
    tocList.appendChild(li);
  });
  
  // Smooth scroll to heading
  document.querySelectorAll('#toc a').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        const offset = 100;
        const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - offset;
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
      }
    });
  });
  
  // Highlight current section in TOC
  const observerOptions = {
    rootMargin: '-100px 0px -66%',
    threshold: 0
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const id = entry.target.id;
      const tocLink = document.querySelector(`#toc a[href="#${id}"]`);
      
      if (entry.isIntersecting && tocLink) {
        document.querySelectorAll('#toc a').forEach(link => {
          link.classList.remove('font-bold', 'text-primary-600');
        });
        tocLink.classList.add('font-bold', 'text-primary-600');
      }
    });
  }, observerOptions);
  
  headings.forEach(heading => observer.observe(heading));
})();
</script>

<style>
@media (max-width: 1024px) {
  .toc-container {
    position: relative !important;
    top: auto !important;
  }
}
</style>
{% endif %}

